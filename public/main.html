<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Solusi AIaaS untuk Ekspor Digital Global</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    /* Palet Warna Baru */
    :root {
      --bg-dark-start: #111827; /* Abu-abu Gelap */
      --bg-dark-end: #374151;   /* Abu-abu Sedang */
      --primary-accent: #38bdf8; /* Biru Langit Cerah */
      --primary-accent-hover: #7dd3fc; /* Biru Langit Lebih Terang */
      --text-light: #e5e7eb;   /* Abu-abu Sangat Terang */
      --text-heading: #ffffff;   /* Putih */
      --card-bg: rgba(31, 41, 55, 0.6); /* Abu-abu kebiruan transparan */
      --border-color: rgba(255, 255, 255, 0.1);
      --input-bg: rgba(255, 255, 255, 0.05);
    }

    body {
      background: linear-gradient(135deg, var(--bg-dark-start), var(--bg-dark-end));
      color: var(--text-light);
      font-family: 'Inter', 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
    }

    .navbar {
      background-color: rgba(17, 24, 39, 0.8);
      backdrop-filter: blur(10px);
    }

    .card {
      background-color: var(--card-bg);
      border: 1px solid var(--border-color);
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.3);
      color: var(--text-light);
      border-radius: 15px;
    }
    
    .form-label {
        color: var(--text-light);
        font-weight: 500;
    }
    
    .form-control, .form-select {
        background-color: var(--input-bg);
        border-color: var(--border-color);
        color: var(--text-heading);
        border-radius: 8px;
    }
    
    .form-control:focus, .form-select:focus {
        background-color: var(--input-bg);
        border-color: var(--primary-accent);
        color: var(--text-heading);
        box-shadow: 0 0 0 0.25rem rgba(56, 189, 248, 0.25);
    }
    
    .form-control::placeholder {
        color: #9ca3af;
    }
    
    .btn-primary {
      background-color: var(--primary-accent);
      border: none;
      transition: all 0.3s ease;
      color: var(--bg-dark-start);
      font-weight: 600;
    }
    .btn-primary:hover {
      background-color: var(--primary-accent-hover);
    }

    .chat-window {
      height: 400px;
      overflow-y: auto;
      border: 1px solid var(--border-color);
      padding: 1rem;
      background-color: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
    }
    .chat-message {
      margin-bottom: 1rem;
      display: flex;
      flex-direction: column;
    }
    .chat-message.user {
      align-items: flex-end;
    }
    .chat-message.bot {
      align-items: flex-start;
    }
    .chat-message .message-bubble {
      display: inline-block;
      padding: 0.75rem 1.2rem;
      border-radius: 18px;
      max-width: 85%;
      text-align: left;
      word-wrap: break-word;
      line-height: 1.5;
    }
    .chat-message.user .message-bubble {
      background-color: var(--primary-accent);
      color: var(--bg-dark-start);
      font-weight: 500;
    }
    .chat-message.bot .message-bubble {
      background-color: #374151; /* Abu-abu Sedang */
      color: var(--text-light);
    }
    .chat-message.bot .message-bubble a {
        color: var(--primary-accent-hover);
    }
    .chat-message.bot .message-bubble pre {
        background-color: rgba(0,0,0,0.4);
        padding: 0.75rem;
        border-radius: 8px;
        border: 1px solid var(--border-color);
    }

    #result-container {
        position: relative;
    }
    #ask-ai-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: var(--primary-accent);
        border: none;
        color: var(--bg-dark-start);
    }
    #ask-ai-btn:hover {
        background-color: var(--primary-accent-hover);
    }
    #result {
        background-color: rgba(0, 0, 0, 0.2);
        border-color: var(--border-color);
        color: #fff;
        border-radius: 8px;
    }
    
    .spinner-border {
        color: var(--primary-accent);
    }

    .footer {
      background-color: var(--bg-dark-start);
      color: #9ca3af;
      padding: 2rem 0;
      margin-top: 60px;
      text-align: center;
    }
  </style>
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
    <div class="container">
      <a class="navbar-brand fw-bold" href="/"><i class="bi bi-robot me-2"></i> AIaaS Ekspor Digital</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link" href="/">Beranda</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container py-5">
    <div class="text-center mb-5">
        <h2 class="fw-bold display-6">Platform AIaaS untuk Keunggulan Ekspor Digital</h2>
        <p class="lead" style="color: var(--text-light);">Tingkatkan daya saing global, efisiensi, dan pertumbuhan ekonomi melalui ekspor layanan digital yang didukung AI.</p>
    </div>
    <div class="row g-4">
      <!-- Kolom Chatbot -->
      <div class="col-lg-6">
        <div class="card h-100">
            <div class="card-body d-flex flex-column">
                <h4 class="card-title mb-4">1. Konsultasi dengan Asisten AI</h4>
                <div id="chat-window" class="chat-window flex-grow-1">
                  <!-- Pesan chat akan ditambahkan di sini -->
                </div>
                <div id="loadingChat" class="mt-2 d-none">
                    <span class="text-white"><i>Asisten sedang mengetik...</i></span>
                </div>
                <form id="chatForm" class="mt-3">
                  <div class="input-group">
                    <input type="text" id="chat-input" class="form-control" placeholder="Ketik pertanyaan Anda..." required />
                    <button class="btn btn-primary" type="submit">Kirim <i class="bi bi-send-fill ms-1"></i></button>
                  </div>
                </form>
            </div>
        </div>
      </div>

      <!-- Kolom Analisis Dokumen -->
      <div class="col-lg-6">
        <div class="card h-100">
          <div class="card-body">
            <h4 class="card-title mb-4">2. Analisis Dokumen Cerdas</h4>
            <form id="ocrForm">
              <div class="mb-3">
                <label for="lang" class="form-label">Pilih Bahasa Dokumen</label>
                <select id="lang" name="lang" class="form-select">
                  <option value="ind" selected>ðŸ‡®ðŸ‡© Indonesia</option>
                  <option value="eng">ðŸ‡¬ðŸ‡§ English</option>
                  <option value="chi_sim">ðŸ‡¨ðŸ‡³ Mandarin (Simplified)</option>
                  <option value="chi_tra">ðŸ‡¨ðŸ‡³ Mandarin (Traditional)</option>
                  <option value="jpn">ðŸ‡¯ðŸ‡µ Jepang</option>
                  <option value="kor">ðŸ‡°ðŸ‡· Korea</option>
                  <option value="hin">ðŸ‡®ðŸ‡³ Hindi</option>
                  <option value="tha">ðŸ‡¹ðŸ‡­ Thai</option>
                  <option value="rus">ðŸ‡·ðŸ‡º Rusia</option>
                  <option value="ara">ðŸ‡¸ðŸ‡¦ Arab</option>
                  <option value="fas">ðŸ‡®ðŸ‡· Persia (Farsi)</option>
                  <option value="mya">ðŸ‡²ðŸ‡² Burma</option>
                  <option value="sin">ðŸ‡±ðŸ‡° Sinhala</option>
                  <option value="ben">ðŸ‡§ðŸ‡© Bengali</option>
                  <option value="khm">ðŸ‡°ðŸ‡­ Khmer</option>
                  <option value="lao">ðŸ‡±ðŸ‡¦ Lao</option>
                </select>
              </div>

              <div class="mb-3">
                <label for="file" class="form-label">Upload Gambar atau PDF</label>
                <div class="d-flex align-items-center gap-2">
                  <input type="file" class="form-control" id="file" name="file" accept=".png,.jpg,.jpeg,.pdf" />
                  <button type="button" id="clearFileBtn" class="btn btn-outline-danger btn-sm d-none py-2 px-3">X</button>
                </div>
              </div>

              <div class="mb-3">
                <label for="file_url" class="form-label">Atau masukkan URL Gambar/PDF</label>
                <input type="url" class="form-control" id="file_url" name="file_url" placeholder="https://example.com/image.jpg" />
              </div>

              <div class="mb-3">
                <label for="file_id" class="form-label">Atau masukkan Telegram File ID</label>
                <input type="text" class="form-control" id="file_id" name="file_id" placeholder="Contoh: AgADBAADtqwxG_..." />
              </div>

              <button type="submit" class="btn btn-primary w-100 py-2">Proses Dokumen</button>
            </form>

            <div id="loadingOcr" class="mt-4 d-none text-center">
              <div class="spinner-border" role="status">
                <span class="visually-hidden">Processing...</span>
              </div>
              <p class="ms-2 mt-2">Menganalisis dokumen, mohon tunggu...</p>
            </div>

            <hr class="my-4" style="border-color: var(--border-color);"/>
            <h5>Hasil Analisis Teks:</h5>
            <div id="result-container">
              <pre id="result" class="p-3 border rounded" style="white-space: pre-wrap; word-wrap: break-word; min-height: 100px;"></pre>
              <button id="ask-ai-btn" class="btn btn-sm d-none" title="Diskusikan dengan Asisten Virtual"><i class="bi bi-robot fs-5"></i></button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <p>&copy; 2025 AIaaS Ekspor Digital. Seluruh Hak Cipta Dilindungi.</p>
    </div>
  </footer>

  <script>
    // --- Variabel Global & Inisialisasi ---
    const ocrForm = document.getElementById("ocrForm");
    const loadingOcr = document.getElementById("loadingOcr");
    const resultBox = document.getElementById("result");
    const askAiBtn = document.getElementById("ask-ai-btn");
    const langSelect = document.getElementById("lang");

    const chatForm = document.getElementById("chatForm");
    const chatInput = document.getElementById("chat-input");
    const chatWindow = document.getElementById("chat-window");
    const loadingChat = document.getElementById("loadingChat");

    // Buat atau dapatkan session ID unik untuk setiap user
    let sessionId = sessionStorage.getItem('sessionId');
    if (!sessionId) {
      sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substring(2, 9);
      sessionStorage.setItem('sessionId', sessionId);
    }

    // --- Logika Chatbot ---
    function addMessageToChat(message, sender) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `chat-message ${sender}`;
      
      const bubbleDiv = document.createElement('div');
      bubbleDiv.className = 'message-bubble';
      
      if (sender === 'bot') {
        // Render Markdown untuk respons dari bot
        bubbleDiv.innerHTML = marked.parse(message);
      } else {
        bubbleDiv.textContent = message;
      }
      
      messageDiv.appendChild(bubbleDiv);
      chatWindow.appendChild(messageDiv);
      chatWindow.scrollTop = chatWindow.scrollHeight;
    }
    
    async function sendChatMessage(message) {
        addMessageToChat(message, 'user');
        chatInput.value = "";
        loadingChat.classList.remove('d-none');

        try {
            // Placeholder untuk API call, ganti dengan endpoint Anda
            const response = await fetch('/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ sessionId, message })
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || `HTTP Error: ${response.status}`);
            }

            const data = await response.json();
            addMessageToChat(data.reply, 'bot');

        } catch (err) {
            addMessageToChat(`Maaf, terjadi kesalahan: ${err.message}`, 'bot');
        } finally {
            loadingChat.classList.add('d-none');
        }
    }

    chatForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const message = chatInput.value.trim();
      if (message) {
        sendChatMessage(message);
      }
    });

    // --- Logika Analisis Dokumen ---
    ocrForm.addEventListener("submit", async function (e) {
      e.preventDefault();

      const formData = new FormData(ocrForm);
      const fileInput = document.getElementById("file");
      const fileIdInput = document.getElementById("file_id").value.trim();
      const fileUrlInput = document.getElementById("file_url").value.trim();
      const langValue = langSelect.value;

      const hasFile = fileInput.files.length > 0;
      const hasFileId = !!fileIdInput;
      const hasfileUrl = !!fileUrlInput;

      if (!hasFile && !hasFileId && !hasfileUrl) {
        resultBox.textContent = "Peringatan: Harap pilih file, masukkan File ID, atau URL gambar terlebih dahulu.";
        resultBox.style.color = "#facc15"; // Warna kuning
        return;
      }

      resultBox.textContent = "";
      resultBox.style.color = "#fff"; // Reset color
      askAiBtn.classList.add("d-none");
      loadingOcr.classList.remove("d-none");

      let requestBody;
      let requestHeaders = {};

      if (!hasFile && (hasFileId || hasfileUrl)) {
        const jsonBody = { lang: langValue };
        if (hasFileId) jsonBody.file_id = fileIdInput;
        if (hasfileUrl) jsonBody.file_url = fileUrlInput;

        requestBody = JSON.stringify(jsonBody);
        requestHeaders["Content-Type"] = "application/json";
      } else {
        requestBody = formData;
      }

      try {
        // Placeholder untuk API call, ganti dengan endpoint Anda
        const response = await fetch("/ocr", {
          method: "POST",
          headers: requestHeaders,
          body: requestBody
        });

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
        }

        const data = await response.json();
        const ocrText = data.text || "Tidak ada teks yang terdeteksi.";
        resultBox.textContent = ocrText;

        if (data.text) {
          askAiBtn.classList.remove("d-none");
        }
      } catch (err) {
        resultBox.textContent = "Request gagal: " + err.message;
      } finally {
        loadingOcr.classList.add("d-none");
        document.getElementById("file").value = '';
        document.getElementById("file_id").value = '';
        document.getElementById("file_url").value = '';
        handleInputLocking();
      }
    });

    // --- Logika UI Tambahan ---
    const fileInput = document.getElementById("file");
    const fileUrlInput = document.getElementById("file_url");
    const fileIdInput = document.getElementById("file_id");
    const clearFileBtn = document.getElementById("clearFileBtn");

    function handleInputLocking() {
      const hasFile = fileInput.files.length > 0;
      const hasUrl = fileUrlInput.value.trim() !== "";
      const hasId = fileIdInput.value.trim() !== "";

      clearFileBtn.classList.toggle("d-none", !hasFile);

      fileUrlInput.disabled = hasFile || hasId;
      fileIdInput.disabled = hasFile || hasUrl;
      fileInput.disabled = hasUrl || hasId;
    }

    fileInput.addEventListener("change", handleInputLocking);
    fileUrlInput.addEventListener("input", handleInputLocking);
    fileIdInput.addEventListener("input", handleInputLocking);

    clearFileBtn.addEventListener("click", () => {
      fileInput.value = "";
      handleInputLocking();
    });

    askAiBtn.addEventListener("click", () => {
      const ocrResult = resultBox.textContent.trim();

      if (ocrResult && ocrResult !== "Tidak ada teks yang terdeteksi.") {
        const prompt = `Berikut adalah teks hasil analisis dari sebuah dokumen. Tolong berikan ringkasan atau poin-poin penting dari teks ini:\n\n---\n\n${ocrResult}\n\n---\n\nBerikan jawaban dalam format Markdown.`;
        sendChatMessage(prompt);
        // Pindahkan fokus ke jendela chat untuk pengalaman pengguna yang lebih baik
        document.getElementById('chat-input').focus();
      }
    });

    // Pesan pembuka dari bot
    addMessageToChat("Selamat datang di platform AIaaS. Saya adalah asisten AI Anda, siap membantu meningkatkan efisiensi dan daya saing bisnis ekspor digital Anda. Silakan unggah dokumen untuk memulai.", 'bot');
  </script>
</body>
</html>
